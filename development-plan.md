# GatherQuiz 開発計画書

## 1. 開発の概要

ドキュメントに基づき、本アプリケーション「GatherQuiz」を以下の技術スタックと方針で開発する。

- **モノリポ構成**: フロントエンド、バックエンド、データベース関連のプロジェクトを一つのリポジトリ内で個別のディレクトリとして管理する。
- **技術スタック**:
    - **フロントエンド**: React (TypeScript) + Vite
        - UIフレームワーク: Material-UI (MUI) with Emotion `styled` API
        - ルーティング: React Router
        - データ取得: TanStack Query (React Query)
    - **バックエンド**: Node.js (TypeScript) + Express
        - データベース: SQLite (開発時), PostgreSQL (本番想定)
        - ORM: Prisma
    - **パッケージ管理**: pnpm (ワークスペース機能を利用)

---

## 2. 現在の進捗

- **フェーズ1: プロジェクト基盤の構築**: ✅ 完了
- **フェーズ2: 主要機能の実装**: ✅ 完了
- **フェーズ3: 大会実施機能と仕上げ**: ✅ 完了
- **フェーズ4: リファクタリング**: ✅ 完了

---

## 3. 開発フェーズ

### フェーズ1: プロジェクト基盤の構築 (完了)

アプリケーションの土台となる開発環境と基本構造を整備した。

- ✅ pnpmワークスペースの初期設定
- ✅ バックエンドプロジェクトのセットアップ (Express, TypeScript, Prisma, SQLite)
- ✅ フロントエンドプロジェクトのセットアップ (React, TypeScript, Vite, React Router, MUI)
- ✅ APIの基本設計と疎通確認
- ✅ Dev Containerによる開発環境のコンテナ化
- ✅ Vitestによる単体テスト基盤の導入 (フロントエンド・バックエンド)

### フェーズ2: 主要機能の実装 (完了)

要件定義に基づき、主催者と参加者のコアとなる機能を実装した。

- **大会作成フローの実装 (完了)**
    - ✅ **画面**: `サービスTOPページ`, `大会作成ページ`, `大会作成完了ページ`
    - ✅ **API**: 大会情報の保存 (`POST /api/tournaments`), 取得 (`GET /api/tournaments/:id`)
- **参加者フローの実装 (完了)**
    - ✅ **画面**: `大会ポータルページ`, `参加者登録ページ`, `問題作成・編集ページ`, `参加者ダッシュボードページ`
    - ✅ **API**: 参加者の登録 (`POST /api/tournaments/:id/participants`), 問題の作成 (`POST /api/quizzes`), 参加者の問題作成状況の取得 (`GET /api/tournaments/:tournamentId/participants/:participantId/quizzes`)
- **主催者管理フローの実装 (完了)**
    - ✅ **画面**: `主催者用 管理ページ` (ログイン機能、大会情報編集機能含む)
    - ✅ **API**: 主催者ログイン (`POST /tournaments/:id/login`), 参加状況の取得 (`GET /tournaments/:id/status`), 大会情報の更新 (`PUT /tournaments/:id`), 大会開始 (`PATCH /tournaments/:id/start`)

### フェーズ3: 大会実施機能と仕上げ (完了)

- **大会実施フローの実装 (完了)**
    - ✅ **画面**: `問題選択ボードページ`, `問題表示ページ`, `解答表示ページ`
    - ✅ **API**: 大会ボード情報の取得 (`GET /tournaments/:id/board`), 個別クイズ情報の取得 (`GET /quizzes/:id`)
- **共通機能の実装 (完了)**
    - ✅ `エラーページ` の作成とルーティング設定。
    - ✅ 画像アップロード機能の実装 (S3への署名付きURL方式)

### フェーズ4: リファクタリング (完了)

コードの品質向上と保守性向上のため、以下のリファクタリングを実施した。

- **バックエンド**
    - ✅ **モデルのクラス化**: DBモデルを`backend/src/model`配下にクラスとして切り出し、Prismaの生オブジェクトから変換して利用するように修正。
    - ✅ **エラーハンドリングの共通化**: `try-catch`ブロックを削減し、Expressの共通エラーハンドリングミドルウェアに処理を統一。
- **フロントエンド**
    - ✅ **データ取得ライブラリ導入**: 当初作成した`useApi`カスタムフックを廃止し、より高機能な`TanStack Query`を導入。キャッシュ機構を活用し、パフォーマンスとUXを向上。
    - ✅ **Styled-Components命名規則の適用**: `styled`で生成したコンポーネントには`Styled`プレフィックスを付与する規約を徹底。

---

## 4. 継続的改善タスク (新規計画)

インフラ構築を一時中断し、以下のフロントエンド改善タスクに着手する。

### 4.1. UI/UXの全体的改善

- **ヘッダーとフッターの導入**
    - [ ] 共通レイアウトコンポーネント (`Layout.tsx`) を作成し、全ページにヘッダー・フッターを適用する。
    - [ ] ヘッダーコンポーネントを作成し、アプリケーションロゴを配置する（クリックでトップページへ遷移）。
    - [ ] フッターコンポーネントを作成し、以下の静的ページへのリンクを設置する。
        - [ ] お問い合わせページ (`/contact`)
        - [ ] プライバシーポリシーページ (`/privacy`)
        - [ ] 利用規約ページ (`/terms`)
    - [ ] 上記3つの静的ページを仮のコンテンツで作成し、ルーティングを設定する。

- **デザインの精緻化**
    - [ ] 現在のUIライブラリ（Material-UI）の延長線で、既存のWebアプリケーションを参考にUIのスタイリングを精緻化する
    - [ ] 主要なUIコンポーネント（ボタン、フォーム、カード等）を、一定の方針でスタイリングを適用してください
    - [ ] スタイリングの基本方針はフラットデザインで、必要以上のアニメーションを付与しない
    - [ ] 精緻化と同時に、E2Eテストで全ての画面のスクリーンショットを撮影するテストケースを作成し、UIデザインの変化を自力で確認できるようにしてください

- **レスポンシブ対応**
    - [ ] 主要なページ（トップ、大会作成、問題作成、問題ボード等）がスマートフォンやタブレット表示で崩れないようにレイアウトを修正する。
    - [ ] メディアクエリやデザインシステムのグリッドシステムを活用し、ブレークポイントに応じたスタイリングを適用する。

---

## 5. デプロイ計画 (進行中)

AWS CloudFormationを用いたデプロイを進行中。

- **本番環境用ACM証明書 (`gather-quiz.june-yamamoto.com`)**:
    - ✅ `us-east-1` リージョンで証明書をリクエスト済み。
    - ✅ Route 53でのDNS検証レコード追加完了。
    - ⏳ AWSによる検証完了待ち。

- **開発環境用ACM証明書 (`dev.gather-quiz.june-yamamoto.com`)**:
    - ✅ `us-east-1` リージョンで証明書をリクエスト済み。
    - ⏳ Route 53でのDNS検証レコード追加待ち。

- **インフラ構成**:
    - **フロントエンド**: Amazon S3 + Amazon CloudFront
    - **バックエンド**: AWS App Runner
    - **データベース**: Amazon RDS (PostgreSQL)
- **DNS管理**:
    - ドメイン全体の管理をRoute 53へ移管済み。